<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boudhina Shop | Marketplace</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FFD700;
            --secondary: #0084ff;
            --bg: #0b0b0b;
            --card: #161616;
            --text: #ffffff;
            --text-muted: #a0a0a0;
            --nav-bg: rgba(10, 10, 10, 0.98);
            --input-bg: #1f1f1f;
            --border: rgba(255,255,255,0.05);
        }

        .light-mode {
            --bg: #f0f2f5;
            --card: #ffffff;
            --text: #1c1e21; /* لون نص غامق وواضح */
            --text-muted: #65676b;
            --nav-bg: rgba(255, 255, 255, 0.98);
            --input-bg: #e4e6eb;
            --border: rgba(0,0,0,0.1);
        }

        body {
            margin: 0; font-family: 'Cairo', sans-serif;
            background: var(--bg); color: var(--text);
            transition: 0.3s; padding-bottom: 90px;
        }

        /* Header Navigation */
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; background: var(--nav-bg); position: sticky; top: 0; z-index: 1000;
            border-bottom: 1px solid var(--border);
        }
        .brand { font-weight: 800; font-size: 20px; color: var(--primary); flex-grow: 1; text-align: center; }
        .header-action { font-size: 20px; cursor: pointer; color: var(--text); width: 40px; display: flex; justify-content: center; }

        /* Slider Styles */
        .slider-container { margin: 15px; border-radius: 20px; overflow: hidden; height: 180px; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .slider { display: flex; height: 100%; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .slide { min-width: 100%; background-size: cover; background-position: center; display: flex; align-items: flex-end; padding: 15px; box-sizing: border-box;}
        .slide-txt { 
            background: var(--primary); color: #000; padding: 6px 15px; border-radius: 50px; 
            font-size: 13px; font-weight: bold; display: flex; align-items: center; gap: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* Content Sections */
        .section { display: none; padding: 10px 20px; max-width: 600px; margin: auto; animation: fadeIn 0.3s; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .search-box { position: relative; margin-bottom: 20px; }
        .search-box i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }
        .search-box input { width: 100%; padding: 12px 40px 12px 15px; border-radius: 15px; border: none; background: var(--input-bg); color: var(--text); outline: none; box-sizing: border-box; border: 1px solid var(--border); }

        /* Cards */
        .card { background: var(--card); border-radius: 20px; overflow: hidden; margin-bottom: 20px; border: 1px solid var(--border); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .card-img { width: 100%; height: 200px; object-fit: cover; }
        .card-content { padding: 15px; }
        .price { color: var(--primary); font-weight: 800; font-size: 18px; }

        .btn-main { background: var(--primary); color: #000; padding: 12px; border: none; border-radius: 12px; width: 100%; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 15px; transition: 0.2s; }
        .btn-chat { background: var(--secondary); color: #fff; margin-top: 10px; }
        
        /* Bottom Navigation */
        .nav {
            position: fixed; bottom: 0; width: 100%; height: 70px;
            background: var(--nav-bg); display: flex; justify-content: space-around; align-items: center;
            border-top: 1px solid var(--border); backdrop-filter: blur(10px);
        }
        .nav-btn { background: none; border: none; color: var(--text-muted); font-size: 22px; cursor: pointer; transition: 0.3s; }
        .nav-btn.active-link { color: var(--primary); transform: translateY(-5px); }

        /* Chat Window */
        #chat-window { position: fixed; inset: 0; background: var(--bg); z-index: 3000; display: none; flex-direction: column; }
        .chat-header { padding: 15px; background: var(--nav-bg); border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 15px; }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background-image: radial-gradient(var(--border) 1px, transparent 1px); background-size: 20px 20px; }
        .msg { padding: 10px 15px; border-radius: 18px; max-width: 80%; font-size: 14px; line-height: 1.4; }
        .msg.sent { background: var(--secondary); color: #fff; align-self: flex-end; border-bottom-right-radius: 2px; }
        .msg.received { background: var(--input-bg); color: var(--text); align-self: flex-start; border-bottom-left-radius: 2px; }
        .chat-input-area { padding: 15px; display: flex; gap: 10px; border-top: 1px solid var(--border); background: var(--nav-bg); }

        /* Forms */
        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 12px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text); box-sizing: border-box; font-family: 'Cairo'; }
        
        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 4000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; text-align: center; }
    </style>
</head>
<body class="dark-mode">

    <div id="auth-screen">
        <i class="fa-solid fa-bolt-lightning" style="font-size: 50px; color: var(--primary); margin-bottom: 15px;"></i>
        <h1 style="margin:0; font-weight: 800; color: #fff;">Boudhina Shop</h1>
        <p style="color: #888; margin-bottom: 30px;">سوق اللاعبين الأسرع في تونس</p>
        <input type="text" id="reg-name" placeholder="الاسم المستعار">
        <input type="email" id="reg-email" placeholder="البريد الإلكتروني">
        <button class="btn-main" onclick="register()">ابدأ الآن</button>
    </div>

    <header>
        <div class="header-action" onclick="showPage('settings', this)"><i class="fa-solid fa-gear"></i></div>
        <div class="brand">Boudhina Shop</div>
        <div class="header-action" onclick="alert('لا توجد إشعارات جديدة')"><i class="fa-solid fa-bell"></i></div>
    </header>

    <div id="home" class="section active">
        <div class="slider-container">
            <div class="slider" id="mainSlider">
                <div class="slide" style="background-image: linear-gradient(transparent, rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1550751827-4bd374c3f58b?w=600')">
                    <div class="slide-txt"><i class="fa-solid fa-shield-check"></i> ضمان 100% وحماية كاملة</div>
                </div>
                <div class="slide" style="background-image: linear-gradient(transparent, rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1542751371-adc38448a05e?w=600')">
                    <div class="slide-txt"><i class="fa-solid fa-bolt"></i> تسليم فوري عبر الدردشة</div>
                </div>
                <div class="slide" style="background-image: linear-gradient(transparent, rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1552820728-8b83bb6b773f?w=600')">
                    <div class="slide-txt"><i class="fa-solid fa-headset"></i> دعم فني متواجد دائماً</div>
                </div>
            </div>
        </div>

        <div class="search-box">
            <i class="fa-solid fa-search"></i>
            <input type="text" id="searchInput" onkeyup="searchPosts()" placeholder="ابحث عن لعبة، حساب، أو بائع...">
        </div>

        <div id="postsList"></div>
    </div>

    <div id="sell" class="section">
        <h2 style="font-weight: 800;">انشر عرضك</h2>
        <div class="upload-area" onclick="document.getElementById('fileInput').click()" style="width: 100%; height: 160px; background: var(--input-bg); border: 2px dashed var(--border); border-radius: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; overflow: hidden; position: relative; margin-bottom: 10px;">
            <i class="fa-solid fa-cloud-arrow-up" style="font-size: 30px; color: var(--text-muted);"></i>
            <span style="font-size: 12px; color: var(--text-muted); margin-top: 5px;">أضف صورة الحساب الواضحة</span>
            <img id="preview" style="display:none; width:100%; height:100%; object-fit:cover; position:absolute;">
        </div>
        <input type="file" id="fileInput" accept="image/*" hidden onchange="handleImage(event)">
        
        <input type="text" id="gameCat" placeholder="اسم اللعبة (مثال: Free Fire)">
        <input type="number" id="price" placeholder="السعر بـ DT">
        <textarea id="desc" rows="3" placeholder="اكتب تفاصيل الحساب (المستوى، السكنات، الخ...)"></textarea>
        <button class="btn-main" style="margin-top: 10px;" onclick="savePost()">نشر العرض الآن</button>
    </div>

    <div id="profile" class="section">
        <div style="text-align:center; padding: 20px;">
            <div style="width: 80px; height: 80px; background: var(--input-bg); border-radius: 50%; margin: 0 auto; display: flex; align-items: center; justify-content: center; border: 3px solid var(--primary);">
                <i class="fa-solid fa-user-gear" style="font-size: 30px; color: var(--primary);"></i>
            </div>
            <h2 id="profile-name" style="margin: 10px 0 0 0;">المستخدم</h2>
            <p id="profile-email" style="color:var(--text-muted); font-size: 13px;"></p>
        </div>
        <h3 style="margin-top: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px;"><i class="fa-solid fa-tags"></i> إعلاناتي النشطة</h3>
        <div id="myPostsList"></div>
    </div>

    <div id="settings" class="section">
        <h2 style="font-weight: 800;">إعدادات الحساب</h2>
        <div style="background: var(--card); border-radius: 20px; padding: 10px; border: 1px solid var(--border);">
            <div style="display:flex; justify-content:space-between; align-items:center; padding: 15px; border-bottom: 1px solid var(--border);">
                <span>الوضع الليلي (Dark Mode)</span>
                <input type="checkbox" checked onchange="toggleTheme()" style="width: 25px; height: 25px;">
            </div>
            <div style="padding: 15px; border-bottom: 1px solid var(--border);">
                <label>لغة التطبيق</label>
                <select id="langSwitcher" onchange="alert('سيتم توفير اللغات الأخرى قريباً')">
                    <option value="ar">العربية (الافتراضية)</option>
                    <option value="fr">Français</option>
                    <option value="en">English</option>
                </select>
            </div>
            <div style="display:flex; justify-content:space-between; padding: 15px; color: #ff5252; cursor: pointer;" onclick="logout()">
                <span>تسجيل الخروج</span>
                <i class="fa-solid fa-power-off"></i>
            </div>
        </div>
        <button class="btn-main" style="margin-top: 20px; background: var(--input-bg); color: var(--text);" onclick="showPage('home', null)">العودة للرئيسية</button>
    </div>

    <div id="chat-window">
        <div class="chat-header">
            <i class="fa-solid fa-chevron-right" style="font-size: 20px; cursor: pointer;" onclick="closeChat()"></i>
            <div style="display: flex; flex-direction: column;">
                <b id="chat-with-name">البائع</b>
                <span style="font-size: 10px; color: #25D366;"><i class="fa-solid fa-circle"></i> متصل الآن</span>
            </div>
        </div>
        <div class="chat-body" id="chat-body"></div>
        <div class="chat-input-area">
            <input type="text" id="chat-msg-input" placeholder="اكتب رسالتك هنا...">
            <button class="btn-main" style="width: 50px;" onclick="sendMessage()"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>

    <nav class="nav">
        <button class="nav-btn active-link" onclick="showPage('home', this)"><i class="fa-solid fa-house-chimney"></i></button>
        <button class="nav-btn" onclick="showPage('sell', this)"><i class="fa-solid fa-plus-circle"></i></button>
        <button class="nav-btn" onclick="showPage('profile', this)"><i class="fa-solid fa-user-circle"></i></button>
    </nav>

    <script>
        let currentImg = "";
        let sIndex = 0;
        let activeChatPartner = "";

        // Authentication & Initialization
        window.onload = () => {
            const user = JSON.parse(localStorage.getItem('user'));
            if(user) {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('profile-name').innerText = user.name;
                document.getElementById('profile-email').innerText = user.email;
            }
            renderPosts();
            startSlider();
        };

        function register() {
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            if(!name || !email) return alert("الرجاء إدخال الاسم والبريد");
            localStorage.setItem('user', JSON.stringify({name, email}));
            location.reload();
        }

        // Slider Logic
        function startSlider() {
            const slider = document.getElementById('mainSlider');
            const total = document.querySelectorAll('.slide').length;
            setInterval(() => {
                sIndex++;
                if(sIndex >= total) sIndex = 0;
                slider.style.transform = `translateX(${sIndex * 100}%)`;
            }, 4000);
        }

        // Post Management
        function handleImage(e) {
            const reader = new FileReader();
            reader.onload = () => {
                currentImg = reader.result;
                document.getElementById('preview').src = currentImg;
                document.getElementById('preview').style.display = 'block';
            };
            reader.readAsDataURL(e.target.files[0]);
        }

        function savePost() {
            const game = document.getElementById('gameCat').value;
            const price = document.getElementById('price').value;
            const desc = document.getElementById('desc').value;
            const user = JSON.parse(localStorage.getItem('user'));

            if(!game || !price || !currentImg) return alert("يرجى إكمال جميع الحقول");

            const posts = JSON.parse(localStorage.getItem('gamePosts') || "[]");
            posts.unshift({ id: Date.now(), game, price, desc, img: currentImg, seller: user.name, sellerEmail: user.email });
            localStorage.setItem('gamePosts', JSON.stringify(posts));
            
            // Clear inputs
            document.getElementById('gameCat').value = "";
            document.getElementById('price').value = "";
            document.getElementById('desc').value = "";
            document.getElementById('preview').style.display = "none";
            
            showPage('home', document.querySelector('.nav-btn'));
            renderPosts();
        }

        function renderPosts() {
            const posts = JSON.parse(localStorage.getItem('gamePosts') || "[]");
            const list = document.getElementById('postsList');
            const currentUser = JSON.parse(localStorage.getItem('user'));
            list.innerHTML = "";
            
            posts.forEach(p => {
                const isMyPost = currentUser && p.sellerEmail === currentUser.email;
                list.innerHTML += `
                    <div class="card">
                        <img class="card-img" src="${p.img}">
                        <div class="card-content">
                            <div style="display:flex; justify-content:space-between;">
                                <b style="font-size:17px">${p.game}</b>
                                <span class="price">${p.price} DT</span>
                            </div>
                            <p style="font-size:13px; color: var(--text-muted); margin: 8px 0;">${p.desc}</p>
                            <div style="font-size:11px; color: var(--text-muted); margin-bottom:10px">
                                <i class="fa-solid fa-shield-halved"></i> بائع موثوق: ${p.seller}
                            </div>
                            ${!isMyPost ? `
                                <button class="btn-main btn-chat" onclick="openChat('${p.seller}')">
                                    <i class="fa-solid fa-comments"></i> دردشة مع البائع
                                </button>
                            ` : `<div style="text-align:center; color:var(--primary); font-size:12px;">إعلانك متاح للجميع</div>`}
                        </div>
                    </div>`;
            });
        }

        function renderMyPosts() {
            const user = JSON.parse(localStorage.getItem('user'));
            const posts = JSON.parse(localStorage.getItem('gamePosts') || "[]");
            const container = document.getElementById('myPostsList');
            container.innerHTML = "";
            
            posts.filter(p => p.sellerEmail === user.email).forEach(p => {
                container.innerHTML += `
                    <div class="card" style="display:flex; align-items:center; padding:10px; gap:15px;">
                        <img src="${p.img}" style="width:60px; height:60px; border-radius:10px; object-fit:cover;">
                        <div style="flex-grow:1">
                            <b style="font-size:14px">${p.game}</b><br>
                            <span class="price" style="font-size:14px">${p.price} DT</span>
                        </div>
                        <button onclick="deletePost(${p.id})" style="background:none; border:none; color:#ff5252; font-size:20px;"><i class="fa-solid fa-trash-can"></i></button>
                    </div>`;
            });
        }

        function deletePost(id) {
            if(!confirm("هل أنت متأكد من حذف هذا الإعلان؟")) return;
            let posts = JSON.parse(localStorage.getItem('gamePosts') || "[]");
            posts = posts.filter(p => p.id !== id);
            localStorage.setItem('gamePosts', JSON.stringify(posts));
            renderMyPosts();
            renderPosts();
        }

        // Chat Interface Logic
        function openChat(sellerName) {
            activeChatPartner = sellerName;
            document.getElementById('chat-with-name').innerText = sellerName;
            document.getElementById('chat-window').style.display = 'flex';
            renderMessages();
        }

        function closeChat() { document.getElementById('chat-window').style.display = 'none'; }

        function sendMessage() {
            const input = document.getElementById('chat-msg-input');
            if(!input.value.trim()) return;
            const messages = JSON.parse(localStorage.getItem('chat_logs') || "[]");
            messages.push({ partner: activeChatPartner, text: input.value, type: 'sent' });
            localStorage.setItem('chat_logs', JSON.stringify(messages));
            input.value = "";
            renderMessages();
            
            // Simulated Response
            setTimeout(() => {
                messages.push({ partner: activeChatPartner, text: "مرحباً! الحساب لا يزال متوفراً. كيف يمكنني مساعدتك؟", type: 'received' });
                localStorage.setItem('chat_logs', JSON.stringify(messages));
                renderMessages();
            }, 1500);
        }

        function renderMessages() {
            const body = document.getElementById('chat-body');
            const messages = JSON.parse(localStorage.getItem('chat_logs') || "[]");
            body.innerHTML = "";
            messages.filter(m => m.partner === activeChatPartner).forEach(m => {
                body.innerHTML += `<div class="msg ${m.type}">${m.text}</div>`;
            });
            body.scrollTop = body.scrollHeight;
        }

        // UI Utilities
        function showPage(id, btn) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(btn) {
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-link'));
                btn.classList.add('active-link');
            }
            if(id === 'profile') renderMyPosts();
            window.scrollTo(0,0);
        }

        function searchPosts() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('#home .card').forEach(c => {
                c.style.display = c.innerText.toLowerCase().includes(q) ? "" : "none";
            });
        }

        function toggleTheme() { document.body.classList.toggle('light-mode'); }
        function logout() { localStorage.removeItem('user'); location.reload(); }
    </script>
</body>
</html>
